name: tg-relay

on:
  repository_dispatch:
    types: [send_telegram]

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram message
        env:
          TG_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          MSG: ${{ github.event.client_payload.text }}
        run: |
          if [ -z "$TG_TOKEN" ] || [ -z "$TG_CHAT_ID" ]; then
            echo "Missing TELEGRAM_BOT_TOKEN or TELEGRAM_CHAT_ID"
            exit 1
          fi

          if [ -z "$MSG" ]; then
            MSG="(empty message from repository_dispatch)"
          fi

          curl -sS -X POST "https://api.telegram.org/bot${TG_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d "{\"chat_id\":\"${TG_CHAT_ID}\",\"text\":\"${MSG}\"}"
